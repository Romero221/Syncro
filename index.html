<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Syncro</title>
    <style>
        /* Light and Dark Theme Styling */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #ffffff;
            color: #000000;
        }

            body.dark-mode {
                background-color: #121212;
                color: #ffffff;
            }

        input[type='text'], select {
            width: 100%;
            padding: 8px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            background-color: #fff;
            color: #000;
        }

            input[type='text'].dark-mode, select.dark-mode {
                background-color: #2c2c2c;
                color: #ffffff;
                border: 1px solid #444;
            }

        button {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            cursor: pointer;
            background-color: #007BFF;
            color: white;
        }

            button.dark-mode {
                background-color: #444;
                color: #ffffff;
            }

        #log {
            margin-top: 20px;
            white-space: pre-wrap;
            background: #f0f0f0;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
            font-family: monospace;
        }

            #log.dark-mode {
                background-color: #1e1e1e;
                color: #c9c9c9;
                border: 1px solid #444;
            }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

            .switch input {
                opacity: 0;
                width: 0;
                height: 0;
            }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }
    </style>
</head>
<body>
    <h1>Syncro</h1>
    <div style="display: flex; align-items: center; justify-content: space-between;">
        <div>
            <label class="switch">
                <input type="checkbox" id="modeSwitch">
                <span class="slider"></span>
            </label>
            <label id="modeLabel">Sync Excel to Monday</label>
        </div>
        <button id="themeToggle">Toggle Theme</button>
    </div>
    <br><br>
    <div>
        <label for="api-key">API Key:</label>
        <input id="api-key" type="text" placeholder="Enter your Monday API key" />
        <button id="fetch-workspaces">Fetch Workspaces</button>
    </div>
    <div>
        <label for="workspace-dropdown">Workspace:</label>
        <select id="workspace-dropdown">
            <option value="">Select a workspace</option>
        </select>
    </div>
    <div>
        <label for="board-dropdown">Board:</label>
        <select id="board-dropdown">
            <option value="">Select a board or create new</option>
        </select>
    </div>
    <br />
    <label for="filePath">Excel File:</label>
    <input type="text" id="filePath" readonly />
    <button id="selectFile">Select File</button>
    <br /><br />
    <button id="start">Start Processing</button>
    <div id="log"></div>

    <script>
        const themeToggleButton = document.getElementById('themeToggle');
        const body = document.body;

        themeToggleButton.addEventListener('click', () => {
            body.classList.toggle('dark-mode');

            const inputs = document.querySelectorAll('input[type="text"], select');
            inputs.forEach(input => input.classList.toggle('dark-mode'));

            const log = document.getElementById('log');
            log.classList.toggle('dark-mode');

            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => button.classList.toggle('dark-mode'));
        });

        // Listen for log messages from the main process
        window.electronAPI.onLogMessage((event, message) => {
            const logElement = document.getElementById('log');
            const formattedMessage = `[${new Date().toLocaleTimeString()}] ${message}\n`;

            // Append the new log to the existing content
            logElement.textContent += formattedMessage;

            // Scroll to the bottom of the log
            logElement.scrollTop = logElement.scrollHeight;
        });


        const fetchWorkspacesButton = document.getElementById('fetch-workspaces');
        const workspaceDropdown = document.getElementById('workspace-dropdown');
        const boardDropdown = document.getElementById('board-dropdown');
        const filePathInput = document.getElementById('filePath');
        const selectFileButton = document.getElementById('selectFile');
        const startButton = document.getElementById('start');
        const logElement = document.getElementById('log');

        fetchWorkspacesButton.addEventListener('click', async () => {
            const apiKey = document.getElementById('api-key').value;

            if (!apiKey) {
                alert('Please enter your API key.');
                return;
            }

            try {
                logElement.textContent = 'Fetching workspaces...';
                const workspaceQuery = `
                {
                    workspaces {
                        id
                        name
                    }
                }
            `;

                const response = await fetch('https://api.monday.com/v2', {
                    method: 'POST',
                    headers: {
                        Authorization: apiKey,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query: workspaceQuery }),
                });

                if (!response.ok) {
                    throw new Error('HTTP Error: ' + response.status);
                }

                const data = await response.json();
                if (data.errors) {
                    throw new Error('GraphQL Errors: ' + JSON.stringify(data.errors));
                }

                // Populate workspace dropdown
                workspaceDropdown.innerHTML = '<option value="">Select a workspace</option>';
                data.data.workspaces.forEach(workspace => {
                    const option = document.createElement('option');
                    option.value = workspace.id;
                    option.textContent = workspace.name;
                    workspaceDropdown.appendChild(option);
                });

                logElement.textContent = 'Workspaces loaded successfully.';
            } catch (error) {
                logElement.textContent = 'Error: ' + error.message;
                console.error(error);
            }
        });

        workspaceDropdown.addEventListener('change', async () => {
            const selectedWorkspaceId = workspaceDropdown.value;
            const apiKey = document.getElementById('api-key').value;

            if (!selectedWorkspaceId) {
                boardDropdown.innerHTML = '<option value="">Select a board</option>';
                return;
            }

            try {
                logElement.textContent = 'Fetching boards...';
                const boardQuery = `
                {
                    boards(workspace_ids: [${selectedWorkspaceId}]) {
                        id
                        name
                    }
                }
            `;

                const response = await fetch('https://api.monday.com/v2', {
                    method: 'POST',
                    headers: {
                        Authorization: apiKey,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query: boardQuery }),
                });

                if (!response.ok) {
                    throw new Error('HTTP Error: ' + response.status);
                }

                const data = await response.json();
                if (data.errors) {
                    throw new Error('GraphQL Errors: ' + JSON.stringify(data.errors));
                }

                // Populate board dropdown
                boardDropdown.innerHTML = '<option value="">Select a board</option>';
                data.data.boards.forEach(board => {
                    const option = document.createElement('option');
                    option.value = board.id;
                    option.textContent = board.name;
                    boardDropdown.appendChild(option);
                });

                logElement.textContent = 'Boards loaded successfully.';
            } catch (error) {
                logElement.textContent = 'Error: ' + error.message;
                console.error(error);
            }
        });

        selectFileButton.addEventListener('click', async () => {
            const filePath = await window.electronAPI.selectFile();
            filePathInput.value = filePath || '';
        });

        startButton.addEventListener('click', async () => {
            const boardId = boardDropdown.value;
            const apiKey = document.getElementById('api-key').value;
            const filePath = filePathInput.value;

            if (!boardId || !apiKey || !filePath) {
                alert('Please fill in all fields.');
                return;
            }

            logElement.textContent = 'Processing...';

            try {
                const isSyncToMonday = !document.getElementById('modeSwitch').checked;
                const method = isSyncToMonday ? 'startProcessing' : 'syncMondayToExcel';

                const result = await window.electronAPI[method]({
                    boardId,
                    apiKey,
                    filePath,
                });

                logElement.textContent = result.message;
            } catch (error) {
                console.error('', error);
                logElement.textContent = 'Error: ' + error.message;
            }
        });

        // Adjusting Mode Label
        const modeSwitch = document.getElementById('modeSwitch');
        const modeLabel = document.getElementById('modeLabel');

        modeSwitch.addEventListener('change', () => {
            modeLabel.textContent = modeSwitch.checked ? 'Sync Monday to Excel' : 'Sync Excel to Monday';
        });
    </script>
</body>
</html>
